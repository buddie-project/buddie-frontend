<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/profilePages/Bookmarks.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/profilePages/Bookmarks.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import '../../style/profilePages/ProfileLayout.css';
import '../../style/profilePages/Bookmarks.css';
import React, { useEffect, useState, useMemo } from "react";
import { Link } from "react-router-dom";
import Pagination from "../../components/generalComponents/Pagination.jsx";
import api from "../../services/api.js";
import { useUserContext } from "../../services/UserContext.jsx";
import { toast } from 'react-toastify';
import seedrandom from "seedrandom";

/**
 * Cores predefinidas para os cartões de cursos guardados, usadas para atribuição aleatória.
 * @type {string[]}
 */
const BOOKMARKS_COLORS = ["red", "blue", "green", "orange", "purple", "yellow", "darkblue"];

/**
 * Atribui uma cor aleatória a cada curso guardado numa lista.
 * A seleção de cor é determinística baseada no courseId ou courseName para consistência visual.
 * @param {object[]} courses - A lista de objetos de curso.
 * @returns {object[]} A lista de cursos com a propriedade 'color' adicionada.
 */
const assignColorsToBookmarks = (courses) => {
    return courses.map((course) => {
        const rng = seedrandom(course.courseId?.toString() || course.courseName || Date.now());
        const colorIndex = Math.floor(rng() * BOOKMARKS_COLORS.length);
        const color = BOOKMARKS_COLORS[colorIndex];
        return { ...course, color };
    });
};

/**
 * @typedef {object} UserContextObject
 * @property {object|null} user - O objeto do utilizador autenticado, ou `null`.
 * @property {boolean} loading - Indica se o contexto do utilizador está a carregar.
 */

/**
 * Componente Bookmarks.
 * Exibe uma lista paginada de cursos que o utilizador guardou para "Ver mais tarde".
 * Permite remover cursos da lista de guardados.
 * @returns {JSX.Element} O componente Bookmarks.
 */
function Bookmarks() {
    /**
     * Estado para o título da página ativa (fixo como 'Ver mais tarde').
     * @type {string}
     */
    const [activePage] = useState('Ver mais tarde');
    /**
     * Estado para armazenar a lista de cursos guardados.
     * @type {object[]}
     */
    const [savedCourses, setSavedCourses] = useState([]);
    /**
     * Estado para a página atual da paginação.
     * @type {number}
     */
    const [currentPage, setCurrentPage] = useState(1);
    /**
     * Estado para indicar se os cursos estão a ser carregados.
     * @type {boolean}
     */
    const [isLoading, setIsLoading] = useState(true);
    /**
     * Estado para armazenar mensagens de erro caso a carga dos cursos falhe.
     * @type {string|null}
     */
    const [error, setError] = useState(null);
    /**
     * Número de itens a serem exibidos por página.
     * @type {number}
     */
    const itemsPerPage = 8;

    /**
     * Hook para aceder ao contexto do utilizador.
     * @type {UserContextObject}
     */
    const { user } = useUserContext();

    /**
     * Efeito para buscar os cursos guardados do utilizador.
     * É executado quando o objeto `user` do contexto muda.
     */
    useEffect(() => {
        const fetchSavedCourses = async () => {
            setIsLoading(true);
            setError(null);
            try {
                const response = await api.get(`/api/user/saved`);

                const coursesToProcess = response.data
                    .filter(savedCourseDto => savedCourseDto.course != null)
                    .map(savedCourseDto => ({
                        id: savedCourseDto.id,
                        courseId: savedCourseDto.course?.courseId,
                        courseName: savedCourseDto.course?.courseName,
                        fieldOfStudy: savedCourseDto.course?.fieldOfStudy,
                        institutionName: savedCourseDto.course?.institutionName,
                        institutionId: savedCourseDto.course?.institutionId
                    }));

                const finalCourses = assignColorsToBookmarks(coursesToProcess);
                setSavedCourses(finalCourses);

            }
            catch (err) {
                console.error("Erro ao buscar cursos guardados:", err);
                setError("Não foi possível carregar os cursos guardados. Por favor, tente novamente.");
                toast.error("Erro ao carregar cursos guardados.", { theme: "colored" });
                setSavedCourses([]);
            }
            finally {
                setIsLoading(false);
            }
        };

        fetchSavedCourses();
    }, [user]);

    /**
     * Lida com a remoção de um curso da lista "Ver mais tarde".
     * Envia um pedido para a API para remover o curso e atualiza o estado localmente.
     * @param {number|string} savedCourseEntryId - O ID da entrada do curso guardado a ser removida.
     */
    const handleRemoveBookmark = async (savedCourseEntryId) => {
        try {
            // BUG CORRIGIDO: O {id} na string do URL agora é substituído pelo valor da variável.
            await api.post(`/api/user/saved/${savedCourseEntryId}/delete`);
            setSavedCourses(prev => prev.filter(sc => sc.id !== savedCourseEntryId));
            toast.success("Curso removido da lista 'Ver mais tarde'!", { theme: "colored" });
        } catch (error) {
            console.error("Erro ao remover curso guardado:", error);
            const errorMessage = error.response?.data?.message || "Erro ao remover o curso guardado.";
            toast.error(errorMessage, { theme: "colored" });
        }
    };

    /**
     * Calcula o número total de páginas com base na quantidade de cursos e itens por página.
     * Memoizado para evitar recálculos desnecessários.
     * @type {number}
     */
    const totalPages = useMemo(() => Math.ceil(savedCourses.length / itemsPerPage), [savedCourses]);

    /**
     * Calcula a sub-lista de cursos a serem exibidos na página atual.
     * Memoizado para evitar recálculos desnecessários.
     * @type {object[]}
     */
    const displayedCourses = useMemo(() => {
        const start = (currentPage - 1) * itemsPerPage;
        return savedCourses.slice(start, start + itemsPerPage);
    }, [savedCourses, currentPage]);

    return (
        &lt;div className="container-card-two">
            &lt;h2 className="card-two-title">{activePage}&lt;/h2>
            &lt;div className="card-two">
                &lt;div className="bookmarks-profile-container">
                    {isLoading ? (
                        &lt;p className="loading-text">A carregar...&lt;/p>
                    ) : error ? (
                        &lt;p className="error-text">{error}&lt;/p>
                    ) : displayedCourses.length === 0 ? (
                        &lt;p className="empty-text">Nenhum curso salvo para ver mais tarde.&lt;/p>
                    ) : (
                        &lt;div className="courses-container-profile">
                            {displayedCourses.map((course) => (
                                &lt;div key={course.id} className={`course-card-profile ${course.color || "default-color"}`}>
                                    &lt;Link to={`/cursos/${course.courseId}`} className="course-link">
                                        &lt;h3 className="course-name">{course.courseName}&lt;/h3>
                                        &lt;p>{course.fieldOfStudy}&lt;/p>
                                    &lt;/Link>
                                    &lt;span
                                        className="icon-bookmark-filled bookmark-icon-bottom"
                                        onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleRemoveBookmark(course.id); }}
                                        aria-hidden="true"
                                    >&lt;/span>
                                &lt;/div>
                            ))}
                        &lt;/div>
                    )}
                &lt;/div>
                {totalPages > 1 &amp;&amp; (
                    &lt;Pagination
                        currentPage={currentPage}
                        totalPages={totalPages}
                        onPageChange={setCurrentPage}
                    />
                )}
            &lt;/div>
        &lt;/div>
    );
}

export default Bookmarks;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#About">About</a></li><li><a href="global.html#AdminPage">AdminPage</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#AutocompleteDropdown">AutocompleteDropdown</a></li><li><a href="global.html#BOOKMARKS_COLORS">BOOKMARKS_COLORS</a></li><li><a href="global.html#Bookmarks">Bookmarks</a></li><li><a href="global.html#COLORS">COLORS</a></li><li><a href="global.html#Calendar">Calendar</a></li><li><a href="global.html#Comments">Comments</a></li><li><a href="global.html#Configurations">Configurations</a></li><li><a href="global.html#CourseDetails">CourseDetails</a></li><li><a href="global.html#Courses">Courses</a></li><li><a href="global.html#FAVORITES_COLORS">FAVORITES_COLORS</a></li><li><a href="global.html#Faqs">Faqs</a></li><li><a href="global.html#Favorites">Favorites</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Homepage">Homepage</a></li><li><a href="global.html#InstitutionDetails">InstitutionDetails</a></li><li><a href="global.html#Interactions">Interactions</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#Navbar">Navbar</a></li><li><a href="global.html#Notifications">Notifications</a></li><li><a href="global.html#Pagination">Pagination</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#ProfileLayout">ProfileLayout</a></li><li><a href="global.html#ProtectedRoute">ProtectedRoute</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#SignIn">SignIn</a></li><li><a href="global.html#SignUp">SignUp</a></li><li><a href="global.html#UserContext">UserContext</a></li><li><a href="global.html#UserProvider">UserProvider</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#assignColorsToBookmarks">assignColorsToBookmarks</a></li><li><a href="global.html#assignColorsToCourses">assignColorsToCourses</a></li><li><a href="global.html#assignColorsToFavorites">assignColorsToFavorites</a></li><li><a href="global.html#setUserContextRef">setUserContextRef</a></li><li><a href="global.html#useUserContext">useUserContext</a></li><li><a href="global.html#userContextRef">userContextRef</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Jul 17 2025 23:05:57 GMT+0100 (Hora de verão da Europa Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
