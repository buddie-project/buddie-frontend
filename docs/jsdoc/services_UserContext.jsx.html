<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/UserContext.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/UserContext.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { createContext, useContext, useEffect, useState } from "react";
import api from "./api.js";

/**
 * @typedef {object} UserData
 * @property {number} id - O ID do utilizador.
 * @property {string} username - O nome de utilizador.
 * @property {string} email - O email do utilizador.
 * @property {string} role - O role do utilizador (ex: "USER", "ADMIN").
 * // Adicione outras propriedades do objeto UserResponseDTO conforme necessário.
 */

/**
 * @typedef {object} UserContextValue
 * @property {UserData|null} user - O objeto do utilizador autenticado, ou `null`.
 * @property {function(UserData|null): void} setUser - Função para definir o objeto do utilizador.
 * @property {boolean} loading - Indica se o contexto do utilizador está a carregar.
 * @property {function(string, string): Promise&lt;boolean>} login - Função para realizar o login.
 * @property {function(): Promise&lt;void>} logout - Função para realizar o logout.
 */

/**
 * Contexto do utilizador. O valor inicial é null.
 * @type {React.Context&lt;UserContextValue|null>}
 */
const UserContext = createContext(null);

/**
 * Hook personalizado para consumir o contexto do utilizador.
 * Permite que qualquer componente filho aceda aos dados e funções fornecidas pelo UserProvider.
 * @returns {UserContextValue} O objeto de contexto do utilizador.
 */
export const useUserContext = () => useContext(UserContext);

/**
 * Componente Provedor do Utilizador.
 * Responsável por gerir o estado global do utilizador (autenticado/não autenticado)
 * e por fornecer funções de login/logout aos seus componentes filhos.
 * @param {object} props - As propriedades do componente.
 * @param {React.ReactNode} props.children - Os componentes filhos que terão acesso ao contexto.
 * @returns {JSX.Element} O provedor do contexto do utilizador.
 */
const UserProvider = ({ children }) => {
    /**
     * Estado para armazenar os dados do utilizador logado.
     * Espera-se que este objeto contenha propriedades como id, username, email, e role (ex: "USER", "ADMIN").
     * @type {UserData|null}
     */
    const [user, setUser] = useState(null);

    /**
     * Estado para indicar se os dados do utilizador estão a ser carregados (ex: no carregamento inicial da página).
     * @type {boolean}
     */
    const [loading, setLoading] = useState(true);

    /**
     * Efeito que é executado apenas uma vez ao montar o componente (equivalente a componentDidMount).
     * Tenta obter os dados do utilizador logado do backend para manter a sessão.
     */
    useEffect(() => {
        /**
         * Função assíncrona para buscar os dados do utilizador logado a partir da API.
         * Atualiza o estado `user` e `loading` com base na resposta da API.
         */
        const fetchUser = async () => {
            try {
                // Tenta obter o utilizador logado do endpoint do backend.
                // A resposta esperada é o UserResponseDTO completo com o Role do utilizador.
                let response = await api.get("/api/user/logged");
                if (response.data) {
                    setUser(response.data); // Define os dados do utilizador no estado
                }
            } catch (error) {
                // Em caso de erro (ex: utilizador não autenticado, token expirado, erro de serialização do backend),
                // garante que o estado do utilizador é limpo.
                console.error('Erro ao obter utilizador logado:', error);
                setUser(null);
            } finally {
                // Marca o carregamento como concluído, independentemente do sucesso ou falha,
                // para que a aplicação possa renderizar o conteúdo.
                setLoading(false);
            }
        };

        fetchUser();
    }, []); // O array vazio assegura que este efeito é executado apenas uma vez.

    /**
     * Função para lidar com o processo de login do utilizador.
     * Envia as credenciais para o backend e atualiza o estado do utilizador em caso de sucesso.
     * @param {string} username - O nome de utilizador para login.
     * @param {string} password - A senha para login.
     * @returns {Promise&lt;boolean>} - True se o login for bem-sucedido, False caso contrário.
     */
    const login = async (username, password) => {
        try {
            // Envia as credenciais para o endpoint de login do backend.
            // Assume que o backend retorna um objeto com uma propriedade 'user'
            // que contém os dados completos do utilizador (incluindo o role).
            const response = await api.post('/api/login', { username, password });
            if (response.data &amp;&amp; response.data.user) {
                setUser(response.data.user); // Atualiza o estado do utilizador no contexto
                return true; // Indica sucesso no login
            }
            return false; // Indica falha no login (sem dados de utilizador na resposta)
        } catch (error) {
            console.error("Erro no login:", error);
            // Poderá adicionar notificações ao utilizador aqui (ex: toast.error("Credenciais inválidas")).
            return false; // Indica falha no login devido a erro
        }
    };

    /**
     * Função para lidar com o processo de logout do utilizador.
     * Envia um pedido para o backend para invalidar a sessão e limpa o estado do utilizador no frontend.
     */
    const logout = async () => {
        try {
            // Envia um pedido POST para o endpoint de logout do Spring Security.
            // O endpoint de logout no Spring Security por padrão é POST /logout ou /api/logout.
            // Verifique a sua configuração em SecurityWebConfig.java para confirmar o endpoint exato.
            await api.post("/api/logout");
            // Limpa o estado do utilizador após o logout bem-sucedido.
            setUser(null);
            // Opcional: Pode redirecionar o utilizador para a homepage após o logout.
            // Por exemplo: navigate('/'); se estiver usando useNavigate em um componente.
        } catch (error) {
            console.error('Erro ao fazer logout:', error);
            // Aqui também pode integrar notificações de erro ao utilizador.
        }
    };

    return (
        // Fornece o objeto de utilizador, a função para definir o utilizador,
        // o estado de carregamento e as funções de login/logout aos componentes filhos.
        &lt;UserContext.Provider value={ {user, setUser, loading, login, logout} }>
            {/* Enquanto o utilizador está a ser carregado, exibe uma mensagem de "Carregando...".
                Após o carregamento (sucesso ou falha), renderiza os componentes filhos. */}
            {loading ? &lt;div>Carregando...&lt;/div> : children}
        &lt;/UserContext.Provider>
    );
};

export default UserProvider;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#About">About</a></li><li><a href="global.html#AdminPage">AdminPage</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#AutocompleteDropdown">AutocompleteDropdown</a></li><li><a href="global.html#BOOKMARKS_COLORS">BOOKMARKS_COLORS</a></li><li><a href="global.html#Bookmarks">Bookmarks</a></li><li><a href="global.html#COLORS">COLORS</a></li><li><a href="global.html#Calendar">Calendar</a></li><li><a href="global.html#Comments">Comments</a></li><li><a href="global.html#Configurations">Configurations</a></li><li><a href="global.html#CourseDetails">CourseDetails</a></li><li><a href="global.html#Courses">Courses</a></li><li><a href="global.html#FAVORITES_COLORS">FAVORITES_COLORS</a></li><li><a href="global.html#Faqs">Faqs</a></li><li><a href="global.html#Favorites">Favorites</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Homepage">Homepage</a></li><li><a href="global.html#InstitutionDetails">InstitutionDetails</a></li><li><a href="global.html#Interactions">Interactions</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#Navbar">Navbar</a></li><li><a href="global.html#Notifications">Notifications</a></li><li><a href="global.html#Pagination">Pagination</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#ProfileLayout">ProfileLayout</a></li><li><a href="global.html#ProtectedRoute">ProtectedRoute</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#SignIn">SignIn</a></li><li><a href="global.html#SignUp">SignUp</a></li><li><a href="global.html#UserContext">UserContext</a></li><li><a href="global.html#UserProvider">UserProvider</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#assignColorsToBookmarks">assignColorsToBookmarks</a></li><li><a href="global.html#assignColorsToCourses">assignColorsToCourses</a></li><li><a href="global.html#assignColorsToFavorites">assignColorsToFavorites</a></li><li><a href="global.html#setUserContextRef">setUserContextRef</a></li><li><a href="global.html#useUserContext">useUserContext</a></li><li><a href="global.html#userContextRef">userContextRef</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Jul 17 2025 23:05:58 GMT+0100 (Hora de verão da Europa Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
